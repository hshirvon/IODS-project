# **Chapter6:Analysis on Longitudinal data**

**1.** Implementing the analyses of Chapter 8 of MABS using the RATS data.

- First, I will read the RATS dataset into R and have a look at it.
```{r}
#  Reading the RATS data set into R. 
RATSL <- read.table("data/RATS.csv",sep  =",",header = TRUE)

str(RATSL)
summary(RATSL)
names(RATSL)
head(RATSL)

# Factor ID & Group in RATS dataset
RATSL$ID <- factor(RATSL$ID)
RATSL$Group <- factor(RATSL$Group)

```

**Graphical Displays of Longitudinal Data**

Graphical displays of data are almost always useful for exposing patterns in the data. Following Kimmo's book, I will next plot the data

```{r}
#Access the package ggplot2
library(ggplot2)
# Draw the plot
ggplot(RATSL, aes(x = Time, y = rats, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(RATSL$rats), max(RATSL$rats)))

#An important effect we want to take notice is how the rats who have higher value of "rats" at the beginning tend to have higher values throughout the study. This phenomenon is generally referred to as tracking.The tracking phenomenon can be seen more clearly in a plot of the standardized values of each observation.

# Standardise the variable rats
RATSL <- RATSL %>%
  group_by(Time) %>%
  mutate(stdrats = (rats - mean(rats))/sd(rats) ) %>%
  ungroup()

glimpse(RATSL)

# Plot again with the standardised bprs
ggplot(RATSL, aes(x = Time, y = stdrats, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  scale_y_continuous(name = "standardized rats")
```

We can see that there are big differences in the value of "rats" between the 3 groups. The individual in different groups have similar outcomes ecxept for the one observation in group 2. 



**Summary Measure Analysis of Longitudinal Data**

With large numbers of observations, graphical displays of individual response profiles are of little use and investigators then commonly produce graphs showing average (mean) profiles for each treatment group along with some indication of the variation of the observations at each time point, in this case the standard error of mean.

```{r}
library(dplyr)
library(tidyr) 

# Number of Time
n <- RATSL$Time %>% unique() %>% length()

# Summary data with mean and standard error of bprs by treatment and week 
RATSS <- RATSL %>%
  group_by(Group, Time) %>%
  summarise( mean = mean(rats), se = sd(rats)/sqrt(n) ) %>%
  ungroup()

# Glimpse the data
glimpse(RATSS)

# Plot the mean profiles
ggplot(RATSS, aes(x = Time, y = mean, linetype = Group, shape = Group)) +
  geom_line() +
  scale_linetype_manual(values = c(1,2,3)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2,3)) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.8,0.8)) +
  scale_y_continuous(name = "mean(rats) +/- se(rats)")


```

In the case of the RATS dataset, I do not think that this summary graph offers much more information compared to the previous graphs. We can see that the standard error of group 2 is bigger than in the other groups, propably explained to some part by the one value that differed from the others,


**2.**Implement the analyses of Chapter 9 of MABS using the BPRS data. (0-8 points: 0-4 points for graphs or analysis results + 0-4 points for their interpretations)